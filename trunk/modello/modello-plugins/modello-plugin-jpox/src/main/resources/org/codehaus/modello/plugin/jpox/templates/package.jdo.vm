<?xml version="1.0"?>

<!DOCTYPE jdo PUBLIC
  "-//Sun Microsystems, Inc.//DTD Java Data Objects Metadata 1.0//EN"
  "http://java.sun.com/dtd/jdo_1_0.dtd">

<jdo>
  <package name="$package">
#foreach( $class in $model.allClasses )
#if( $class.getMetadata( $storeClassMetadataId ).storable )
  <class name="$class.name" identity-type="datastore">
  <!--
    <extension vendor-name="jpox" key="key-auto-increment" value="true"/>
  -->
#foreach( $field in $class.allFields )
#set( $fieldMetadata = $field.getMetadata( $storeFieldMetadataId ) )
#if( $fieldMetadata.storable )
#set( $persistenceModifier = 'persistence-modifier="persistent"' )
#set( $defaultFetchGroup = 'default-fetch-group="true"' )
#else
#set( $persistenceModifier = 'persistence-modifier="none"' )
#set( $defaultFetchGroup = "" )
#end
#if( $field.name == "id" )
#set( $primaryKey = "primary-key='true'" )
#else
#set( $primaryKey = "primary-key='false'" )
#end
#if( $field.required )
#set( $nullValue = "null-value='exception'" )
#else
#set ( $nullValue = "null-value='none'" )
#end
#if( $field.type == "java.util.List" )
    <field name="$field.name"
      $persistenceModifier
      $nullValue
      $defaultFetchGroup>
      <collection element-type="$field.to"/>
    </field>
#elseif( $field.type == "java.util.Set" )
    <field name="$field.name"
      $persistenceModifier
      $nullValue
      $defaultFetchGroup>
      <collection element-type="$field.to"/>
    </field>
#elseif( $field.type == "java.util.Map" )
    <field name="$field.name"
      $persistenceModifier
      $nullValue
      $defaultFetchGroup>
      <map key-type="java.lang.Object" value-type="$field.to"/>
    </field>
#elseif( $field.type == "java.util.Properties" )
    <field name="$field.name"
      $persistenceModifier
      $nullValue
      $defaultFetchGroup>
      <map key-type="java.lang.String" value-type="java.lang.String"/>
    </field>
#else
    <field name="$field.name"
      $primaryKey
      $nullValue
      $persistenceModifier
      $defaultFetchGroup>
#if( $fieldMetadata.maxSize > 0)
      <extension vendor-name="jpox" key="length" value="max $fieldMetadata.maxSize"/>
#end
    </field>
#end
#end## for each field
  </class>
#end## class storable
#end## for each class
  </package>
</jdo>
